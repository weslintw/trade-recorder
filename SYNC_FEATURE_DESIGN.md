# äº¤æ˜“åŒæ­¥åŠŸèƒ½è¦åŠƒ

## ğŸ¯ åŠŸèƒ½è¨­è¨ˆ

### 1. è‡ªå‹•åŒæ­¥é¸é …

ä½¿ç”¨è€…å¯ä»¥è¨­å®šè‡ªå‹•åŒæ­¥çš„æ™‚é–“å€é–“ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è‡ªå‹•åŒæ­¥è¨­å®š                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â–¡ å•Ÿç”¨è‡ªå‹•åŒæ­¥                      â”‚
â”‚                                     â”‚
â”‚  åŒæ­¥æ™‚é–“å€é–“ï¼š                      â”‚
â”‚  â—‹ æœ€è¿‘ 1 å¤©                        â”‚
â”‚  â—‹ æœ€è¿‘ 3 å¤©                        â”‚
â”‚  â—‹ æœ€è¿‘ 7 å¤©                        â”‚
â”‚  â—‹ æœ€è¿‘ 1 å€‹æœˆ                      â”‚
â”‚  â—‹ æœ€è¿‘ 3 å€‹æœˆ                      â”‚
â”‚  â— è‡ªè¨‚å€é–“                         â”‚
â”‚    å¾ï¼š[2024-01-01] åˆ°ï¼š[2024-12-31]â”‚
â”‚                                     â”‚
â”‚  åŒæ­¥é »ç‡ï¼š                          â”‚
â”‚  â—‹ æ¯å°æ™‚                           â”‚
â”‚  â— æ¯ 6 å°æ™‚                        â”‚
â”‚  â—‹ æ¯ 12 å°æ™‚                       â”‚
â”‚  â—‹ æ¯å¤©                             â”‚
â”‚                                     â”‚
â”‚  [ å„²å­˜è¨­å®š ]                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ‰‹å‹•åŒæ­¥æŒ‰éˆ•

åœ¨äº¤æ˜“åˆ—è¡¨é é¢é¡¯ç¤ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‹ äº¤æ˜“ç´€éŒ„          [ğŸ”„ åŒæ­¥ cTrader]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¯©é¸å™¨...                           â”‚
â”‚                                     â”‚
â”‚  åŒæ­¥ç‹€æ…‹ï¼šâœ“ å·²åŒæ­¥ï¼ˆ5åˆ†é˜å‰ï¼‰      â”‚
â”‚  ä¸Šæ¬¡åŒæ­¥ï¼š2024-12-26 00:30         â”‚
â”‚  åŒæ­¥æ•¸é‡ï¼š12 ç­†                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

é»æ“Šã€ŒåŒæ­¥ cTraderã€æŒ‰éˆ•å¾Œï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­£åœ¨åŒæ­¥ä¸­...                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â³ æ­£åœ¨é€£æ¥ cTrader...             â”‚
â”‚  âœ“ å·²é€£æ¥                           â”‚
â”‚  â³ æ­£åœ¨ç²å–äº¤æ˜“ç´€éŒ„...             â”‚
â”‚  ğŸ“¥ å·²ç²å– 15 ç­†æ–°äº¤æ˜“              â”‚
â”‚  â³ æ­£åœ¨åŒ¯å…¥è³‡æ–™...                 â”‚
â”‚  âœ“ å·²æˆåŠŸåŒ¯å…¥ 15 ç­†äº¤æ˜“             â”‚
â”‚                                     â”‚
â”‚  [ æŸ¥çœ‹æ–°äº¤æ˜“ ]  [ é—œé–‰ ]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ åŒæ­¥é‚è¼¯è¨­è¨ˆ

### è³‡æ–™æµç¨‹

```
cTrader API
    â†“
ç²å–äº¤æ˜“åˆ—è¡¨
    â†“
æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼ˆby ctrader_order_idï¼‰
    â†“
â”œâ”€ å·²å­˜åœ¨ â†’ æ¯”å°ä¸¦æ›´æ–°ï¼ˆå¦‚æœ‰å·®ç•°ï¼‰
â””â”€ ä¸å­˜åœ¨ â†’ æ–°å¢äº¤æ˜“ç´€éŒ„
    â†“
æ¨™è¨˜ä¾†æºç‚º 'ctrader'
    â†“
åŒæ­¥å®Œæˆ
```

### é˜²æ­¢é‡è¤‡

ä½¿ç”¨ `ctrader_order_id` ä½œç‚ºå”¯ä¸€è­˜åˆ¥ï¼š
- æ¯æ¬¡åŒæ­¥å‰æª¢æŸ¥æ­¤ ID æ˜¯å¦å·²å­˜åœ¨
- å¦‚æœå­˜åœ¨ä¸”è³‡æ–™ç›¸åŒï¼Œè·³é
- å¦‚æœå­˜åœ¨ä½†è³‡æ–™ä¸åŒï¼ˆä¾‹å¦‚å¹³å€‰åƒ¹æ ¼æ›´æ–°ï¼‰ï¼Œå‰‡æ›´æ–°

---

## ğŸ“Š è³‡æ–™å°æ‡‰

### cTrader â†’ æ‰“å–®ç´€éŒ„å™¨

| cTrader æ¬„ä½ | æ‰“å–®ç´€éŒ„å™¨æ¬„ä½ | è½‰æ›é‚è¼¯ |
|--------------|----------------|----------|
| `orderId` | `ctrader_order_id` | ç›´æ¥å°æ‡‰ |
| `symbol` | `symbol` | ç¬¦è™Ÿæ¨™æº–åŒ–ï¼ˆå¦‚ XAUUSDï¼‰ |
| `tradeSide` | `side` | BUYâ†’long, SELLâ†’short |
| `entryPrice` | `entry_price` | ç›´æ¥å°æ‡‰ |
| `closePrice` | `exit_price` | ç›´æ¥å°æ‡‰ |
| `volume` | `lot_size` | è½‰æ›ç‚ºæ¨™æº–æ‰‹æ•¸ |
| `grossProfit` | `pnl` | ç›´æ¥å°æ‡‰ |
| `pips` | `pnl_points` | è½‰æ›ç‚ºé»æ•¸ |
| `entryTimestamp` | `entry_time` | Unixâ†’DateTime |
| `closeTimestamp` | `exit_time` | Unixâ†’DateTime |

---

## âš™ï¸ åŒæ­¥è¨­å®šè³‡æ–™è¡¨

```sql
CREATE TABLE sync_settings (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    auto_sync_enabled BOOLEAN DEFAULT FALSE,
    sync_interval_hours INTEGER DEFAULT 6,
    sync_days_back INTEGER DEFAULT 7,
    custom_start_date DATE,
    custom_end_date DATE,
    last_sync_at DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

---

## ğŸ¨ UI å…ƒä»¶è¨­è¨ˆ

### 1. åŒæ­¥è¨­å®šé é¢
- è·¯ç”±ï¼š`/settings/sync`
- å…ƒä»¶ï¼š`SyncSettings.svelte`

### 2. åŒæ­¥æŒ‰éˆ•å…ƒä»¶
- å…ƒä»¶ï¼š`SyncButton.svelte`
- ä½ç½®ï¼šäº¤æ˜“åˆ—è¡¨é é¢å³ä¸Šè§’

### 3. åŒæ­¥é€²åº¦å°è©±æ¡†
- å…ƒä»¶ï¼š`SyncProgressModal.svelte`
- é¡¯ç¤ºå³æ™‚é€²åº¦

---

## ğŸ“‹ API ç«¯é»

### åŒæ­¥ç›¸é—œ

```
POST /api/v1/ctrader/sync
Body: {
  "from": "2024-01-01T00:00:00Z",  // å¯é¸
  "to": "2024-12-31T23:59:59Z"     // å¯é¸
}
Response: {
  "success": true,
  "synced": 15,
  "skipped": 3,
  "updated": 2
}
```

```
GET /api/v1/ctrader/sync/status
Response: {
  "is_syncing": false,
  "last_sync_at": "2024-12-26T00:30:00Z",
  "last_sync_count": 12
}
```

### è¨­å®šç›¸é—œ

```
GET /api/v1/settings/sync
Response: {
  "auto_sync_enabled": true,
  "sync_interval_hours": 6,
  "sync_days_back": 7
}
```

```
PUT /api/v1/settings/sync
Body: {
  "auto_sync_enabled": true,
  "sync_interval_hours": 6,
  "sync_days_back": 7,
  "custom_start_date": "2024-01-01",
  "custom_end_date": "2024-12-31"
}
```

---

## ğŸ”” åŒæ­¥é€šçŸ¥

åŒæ­¥å®Œæˆå¾Œé¡¯ç¤º Toast é€šçŸ¥ï¼š

```javascript
// æˆåŠŸ
showToast({
  type: 'success',
  message: 'å·²æˆåŠŸåŒæ­¥ 15 ç­†äº¤æ˜“'
});

// éƒ¨åˆ†æˆåŠŸ
showToast({
  type: 'warning',
  message: 'åŒæ­¥å®Œæˆï¼šæ–°å¢ 10 ç­†ï¼Œè·³é 5 ç­†'
});

// å¤±æ•—
showToast({
  type: 'error',
  message: 'åŒæ­¥å¤±æ•—ï¼šcTrader é€£ç·šè¶…æ™‚'
});
```

---

## â° è‡ªå‹•åŒæ­¥å¯¦ä½œ

### å¾Œç«¯å®šæ™‚ä»»å‹™

ä½¿ç”¨ Go çš„ `time.Ticker`ï¼š

```go
func StartAutoSyncScheduler() {
    ticker := time.NewTicker(1 * time.Hour)
    
    go func() {
        for range ticker.C {
            // æª¢æŸ¥æ‰€æœ‰å•Ÿç”¨è‡ªå‹•åŒæ­¥çš„ä½¿ç”¨è€…
            users := GetUsersWithAutoSync()
            
            for _, user := range users {
                // æª¢æŸ¥æ˜¯å¦åˆ°é”åŒæ­¥æ™‚é–“
                if shouldSync(user) {
                    go SyncUserTrades(user)
                }
            }
        }
    }()
}
```

---

## ğŸ¯ å¯¦ä½œå„ªå…ˆé †åº

1. **åŸºç¤åŒæ­¥** - æ‰‹å‹•åŒæ­¥æŒ‰éˆ•ï¼ˆæœ€å„ªå…ˆï¼‰
2. **åŒæ­¥è¨­å®š** - æ™‚é–“å€é–“é¸é …
3. **è‡ªå‹•åŒæ­¥** - å®šæ™‚åŒæ­¥åŠŸèƒ½
4. **é€²éšåŠŸèƒ½** - è¡çªè§£æ±ºã€å¢é‡åŒæ­¥

---

é€™å€‹è¨­è¨ˆå¦‚ä½•ï¼Ÿç­‰æ‚¨çš„ API æ†‘è­‰éƒ½æº–å‚™å¥½å¾Œï¼Œæˆ‘å°±é–‹å§‹å¯¦ä½œï¼ğŸš€

